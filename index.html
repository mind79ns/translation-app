<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>GPT ë²ˆì—­ê¸°</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #F8F9FA;
        }
        
        .main-card {
            max-width: 600px;
            margin: 20px auto;
            padding: 24px;
            background-color: #FFFFFF;
            border: 1px solid #DADCE0;
            border-radius: 8px;
            box-shadow: 0 1px 2px 0 rgba(60, 64, 67, .3), 0 1px 3px 1px rgba(60, 64, 67, .15);
        }
        
        h1 { color: #202124; font-size: 1.5em; font-weight: 500; margin-top: 0; text-align: left; }
        .subtitle { font-size: 0.9em; color: #5F6368; margin-bottom: 24px; text-align: left; }
        
        textarea {
            width: 100%;
            height: 120px;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #DADCE0;
            border-radius: 4px;
            resize: none;
            box-sizing: border-box;
            margin-bottom: 12px;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        select, button {
            padding: 10px 16px;
            font-size: 16px;
            border-radius: 4px;
            border: 1px solid #DADCE0;
            cursor: pointer;
            background-color: #fff;
        }
        select { flex-grow: 1; }
        button { background-color: #1A73E8; color: white; border: none; font-weight: bold; }
        button:hover { background-color: #186ac9; }
        #micBtn { background-color: #EA4335; }
        #micBtn:hover { background-color: #d63c2c; }
        
        .result-box {
            padding: 16px;
            background-color: #F1F3F4;
            border-radius: 4px;
            border: 1px solid #DADCE0;
            min-height: 100px;
            text-align: left;
        }
        
        #translation { font-size: 1.1em; color: #202124; white-space: pre-wrap; }
        #pronunciation { margin-top: 8px; font-style: italic; color: #5F6368; font-size: 0.9em; }
        
        .loading { text-align: center; color: #888; }
        #micStatus { color: #EA4335; font-size: 0.9em; margin-top: 8px; }
    </style>
</head>
<body>
    <div class="main-card">
        <h1>GPT ë²ˆì—­ê¸°</h1>
        <div class="subtitle">ë‚´ê°€ ë§í•˜ê±°ë‚˜ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ë©´ ë²ˆì—­í•´ ë“œë¦½ë‹ˆë‹¤.</div>
        
        <textarea id="inputText" placeholder="ë²ˆì—­í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”."></textarea>
        
        <div class="controls">
            <select id="targetLang">
                <option value="Vietnamese">ë² íŠ¸ë‚¨ì–´</option>
                <option value="Korean">í•œêµ­ì–´</option>
                <option value="English">ì˜ì–´</option>
            </select>
            <select id="speechLang">
                <option value="ko-KR">ìŒì„± ì…ë ¥: í•œêµ­ì–´</option>
                <option value="en-US">ìŒì„± ì…ë ¥: ì˜ì–´</option>
                <option value="vi-VN">ìŒì„± ì…ë ¥: ë² íŠ¸ë‚¨ì–´</option>
            </select>
            <button onclick="translateText()">ë²ˆì—­í•˜ê¸°</button>
            <button id="micBtn" onclick="toggleMic()">ğŸ¤ ìŒì„± ì…ë ¥</button>
        </div>
        <div id="micStatus"></div>

        <div class="result-box">
            <div id="translation">ë²ˆì—­ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
            <div id="pronunciation"></div>
        </div>
    </div>
    
    <script>
        // âœ… 1ë‹¨ê³„ì—ì„œ ì–»ì€ Apps Script API URLì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
        const API_SERVER_URL = "https://script.google.com/macros/s/AKfycbzFM0bLT0uRggZYB9qLSWP897Y1TyDq61DCdjNJ6MCFKStMK7JHh7OROwrbSnNXrlM/exec";

        const inputTextarea = document.getElementById('inputText');
        const micStatusDiv = document.getElementById('micStatus');
        const micBtn = document.getElementById('micBtn');
        const speechLangSelect = document.getElementById('speechLang');
        let recognition;

        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                inputTextarea.value = transcript;
                stopMic();
            };

            recognition.onerror = function(event) {
                micStatusDiv.innerText = "ìŒì„± ì¸ì‹ ì˜¤ë¥˜: " + event.error;
                stopMic();
            };

            recognition.onstart = function() {
                micStatusDiv.innerText = "ë§ˆì´í¬ê°€ ì¼œì¡ŒìŠµë‹ˆë‹¤. ë§ì”€í•˜ì„¸ìš”.";
                micBtn.innerText = "ğŸ”´ ë…¹ìŒ ì¤‘";
            };

            recognition.onend = function() {
                micStatusDiv.innerText = "";
                micBtn.innerText = "ğŸ¤ ìŒì„± ì…ë ¥";
            };
        } else {
            micBtn.style.display = 'none';
            speechLangSelect.style.display = 'none';
            micStatusDiv.innerText = "ì£„ì†¡í•©ë‹ˆë‹¤. ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì…ë ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
        }

        function toggleMic() {
            if (micBtn.innerText === "ğŸ”´ ë…¹ìŒ ì¤‘") {
                stopMic();
            } else {
                startMic();
            }
        }

        function startMic() {
            if (recognition) {
                const selectedLang = speechLangSelect.value;
                recognition.lang = selectedLang;
                inputTextarea.value = "";
                recognition.start();
            }
        }

        function stopMic() {
            if (recognition) {
                recognition.stop();
            }
        }

        async function translateText() {
            const inputText = inputTextarea.value;
            const targetLang = document.getElementById('targetLang').value;
            const translationDiv = document.getElementById('translation');
            const pronunciationDiv = document.getElementById('pronunciation');

            if (!inputText) {
                translationDiv.innerText = "í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                pronunciationDiv.innerText = "";
                return;
            }

            translationDiv.innerHTML = '<div class="loading">ë²ˆì—­ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</div>';
            pronunciationDiv.innerText = "";

            try {
                const response = await fetch(API_SERVER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ inputText, targetLang }),
                });

                const result = await response.json();

                if (result.error) {
                    translationDiv.innerText = "ì˜¤ë¥˜ ë°œìƒ: " + result.error;
                    pronunciationDiv.innerText = "";
                } else {
                    translationDiv.innerText = result.translation;
                    pronunciationDiv.innerText = 'ë°œìŒ: ' + result.pronunciation;
                }
            } catch(e) {
                translationDiv.innerText = "ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + e.message;
                pronunciationDiv.innerText = "";
            }
        }
    </script>
</body>
</html>
